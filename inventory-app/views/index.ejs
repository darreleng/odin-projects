<!DOCTYPE html>
<html>
<head>
    <title>Inventory App</title>
</head>
<body>
    <h1>Current Inventory</h1>
    <ul>
        <li><a href="/category/all">All</a></li>
        <% categories.forEach(obj => { %>
            <li><a href="/category/<%= obj.category.toLowerCase() %>"><%= obj.category %></a><button>Delete</button></li>
        <% }) %>
    </ul>
    <% if (items.length !== 0) { %>
    <table>
        <caption><%= currentCategory %></caption>
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Quantity</th>
                <th scope="col">Price</th>
            </tr>
        </thead>
        <tbody>
            <% items.forEach(item => { %>
                <tr>
                    <td><%= item.name %></td>
                    <td><%= item.quantity %></td>
                    <td>$<%= item.price %></td>
                    <td>
                        <form action="/edit" method="post">
                            <button>Edit</button>
                        </form>
                    </td>
                    <td>
                        <form action="/deleteItem" method="post">
                            <input type="hidden" name="category" value="<%= currentCategory %>">
                            <input type="hidden" name="itemId" value="<%= item.id %>">
                            <button>Delete</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3">
                    <button id="showDialog">Add New Item</button>
                    <dialog id="itemDialog">
                        <div class="dialog-header">
                            <h2>Add New Item</h2>
                            <button id="closeDialog" type="button">&times;</button>
                        </div>

                        <form action="/addItem" method="POST">
                            <input type="text" name="name" placeholder="Item Name" required>
                            <input type="number" name="quantity" placeholder="Quantity" required>
                            <input type="number" name="price" step="0.01" placeholder="Price" required>
                            
                            <select name="category">
                                <% categories.forEach(obj => { %>
                                    <option value="<%= obj.category %>"><%= obj.category %></option>
                                <% }) %>
                            </select>
                            
                            <button type="submit">Add Item</button>
                        </form>
                    </dialog>
                </td>
            </tr>
        </tfoot>
    </table>
    <% } else { %>
        <div class="welcome-message">
            <h2>Welcome to the Inventory Manager</h1>
            <p>Please select a category from the menu to view items.</p>
        </div>
    <% } %>

    <script>
        const dialog = document.getElementById("itemDialog");
        const showBtn = document.getElementById("showDialog");
        const closeBtn = document.getElementById("closeDialog");

        showBtn.addEventListener("click", () => {
            dialog.showModal();
        });

        closeBtn.addEventListener("click", () => {
            dialog.close();
        });

        dialog.addEventListener("click", (e) => {
            if (e.target === dialog) dialog.close();
        });
    </script>
</body>
</html>